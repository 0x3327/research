<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.9.64">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>3327 Research – async_progress_worker</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <script src="../../../../../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="../../../../../../../../../site_libs/quarto-nav/headroom.min.js"></script>
  <script src="../../../../../../../../../site_libs/clipboard/clipboard.min.js"></script>
  <meta name="quarto:offset" content="../../../../../../../../../">
  <script src="../../../../../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
  <script src="../../../../../../../../../site_libs/quarto-search/fuse.min.js"></script>
  <script src="../../../../../../../../../site_libs/quarto-search/quarto-search.js"></script>
  <link href="../../../../../../../../..//images/favicon.ico" rel="icon">
  <script src="../../../../../../../../../site_libs/quarto-html/quarto.js"></script>
  <script src="../../../../../../../../../site_libs/quarto-html/popper.min.js"></script>
  <script src="../../../../../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="../../../../../../../../../site_libs/quarto-html/anchor.min.js"></script>
  <link href="../../../../../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link href="../../../../../../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <script src="../../../../../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="../../../../../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="../../../../../../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <script id="quarto-search-options" type="application/json">{
    "location": "navbar",
    "copy-button": false,
    "collapse-after": 2,
    "panel-placement": "end",
    "type": "overlay",
    "limit": 20,
    "language": {
      "search-no-results-text": "No results",
      "search-matching-documents-text": "matching documents",
      "search-copy-link-title": "Copy link to search",
      "search-hide-matches-text": "Hide additional matches",
      "search-more-match-text": "more match in this document",
      "search-more-matches-text": "more matches in this document",
      "search-clear-button-title": "Clear",
      "search-detached-cancel-button-title": "Cancel",
      "search-submit-button-title": "Submit"
    }
  }</script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="../../../../../../../../../styles.css">
</head>
<body>
<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../../../../../../../../index.html">
    <img src="../../../../../../../../../logo.png" alt="">
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../../../../../../index.html">Overview</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../../../../../documents/research/index.html">Research</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/3327_io"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/0x3327/research"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
<h2 id="toc-title">On this page</h2>
<ul>
<li><a href="#asyncprogressworker" class="nav-link active" data-scroll-target="#asyncprogressworker">AsyncProgressWorker</a>
<ul class="collapse">
<li><a href="#methods" class="nav-link" data-scroll-target="#methods">Methods</a>
<ul class="collapse">
<li><a href="#execute" class="nav-link" data-scroll-target="#execute">Execute</a></li>
<li><a href="#onok" class="nav-link" data-scroll-target="#onok">OnOK</a></li>
<li><a href="#onprogress" class="nav-link" data-scroll-target="#onprogress">OnProgress</a></li>
<li><a href="#constructor" class="nav-link" data-scroll-target="#constructor">Constructor</a></li>
<li><a href="#constructor-1" class="nav-link" data-scroll-target="#constructor-1">Constructor</a></li>
<li><a href="#constructor-2" class="nav-link" data-scroll-target="#constructor-2">Constructor</a></li>
<li><a href="#constructor-3" class="nav-link" data-scroll-target="#constructor-3">Constructor</a></li>
<li><a href="#constructor-4" class="nav-link" data-scroll-target="#constructor-4">Constructor</a></li>
<li><a href="#constructor-5" class="nav-link" data-scroll-target="#constructor-5">Constructor</a></li>
<li><a href="#constructor-6" class="nav-link" data-scroll-target="#constructor-6">Constructor</a></li>
<li><a href="#constructor-7" class="nav-link" data-scroll-target="#constructor-7">Constructor</a></li>
<li><a href="#constructor-8" class="nav-link" data-scroll-target="#constructor-8">Constructor</a></li>
<li><a href="#destructor" class="nav-link" data-scroll-target="#destructor">Destructor</a></li>
</ul></li>
</ul></li>
<li><a href="#asyncprogressworkerexecutionprocess" class="nav-link" data-scroll-target="#asyncprogressworkerexecutionprocess">AsyncProgressWorker::ExecutionProcess</a>
<ul class="collapse">
<li><a href="#methods-1" class="nav-link" data-scroll-target="#methods-1">Methods</a>
<ul class="collapse">
<li><a href="#send" class="nav-link" data-scroll-target="#send">Send</a></li>
</ul></li>
<li><a href="#example" class="nav-link" data-scroll-target="#example">Example</a></li>
</ul></li>
</ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/0x3327/research/edit/main/documents/research/assets/ERFC-42/research_examples/hardhat-test-example/node_modules/node-addon-api/doc/async_progress_worker.md" class="toc-action">Edit this page</a></p><p><a href="https://github.com/0x3327/research/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<section id="asyncprogressworker" class="level1">
<h1>AsyncProgressWorker</h1>
<p><code>Napi::AsyncProgressWorker</code> is an abstract class which implements <code>Napi::AsyncWorker</code> while extending <code>Napi::AsyncWorker</code> internally with <code>Napi::ThreadSafeFunction</code> for moving work progress reports from worker thread(s) to event loop threads.</p>
<p>Like <code>Napi::AsyncWorker</code>, once created, execution is requested by calling <code>Napi::AsyncProgressWorker::Queue</code>. When a thread is available for execution the <code>Napi::AsyncProgressWorker::Execute</code> method will be invoked. During the execution, <code>Napi::AsyncProgressWorker::ExecutionProgress::Send</code> can be used to indicate execution process, which will eventually invoke <code>Napi::AsyncProgressWorker::OnProgress</code> on the JavaScript thread to safely call into JavaScript. Once <code>Napi::AsyncProgressWorker::Execute</code> completes either <code>Napi::AsyncProgressWorker::OnOK</code> or <code>Napi::AsyncProgressWorker::OnError</code> will be invoked. Once the <code>Napi::AsyncProgressWorker::OnOK</code> or <code>Napi::AsyncProgressWorker::OnError</code> methods are complete the <code>Napi::AsyncProgressWorker</code> instance is destructed.</p>
<p>For the most basic use, only the <code>Napi::AsyncProgressWorker::Execute</code> and <code>Napi::AsyncProgressWorker::OnProgress</code> method must be implemented in a subclass.</p>
<section id="methods" class="level2">
<h2 class="anchored" data-anchor-id="methods">Methods</h2>
<p><a href="../../../../../../../../../documents/research/assets/ERFC-42/research_examples/hardhat-test-example/node_modules/node-addon-api/doc/async_worker.html"><code>Napi::AsyncWorker</code></a> provides detailed descriptions for most methods.</p>
<section id="execute" class="level3">
<h3 class="anchored" data-anchor-id="execute">Execute</h3>
<p>This method is used to execute some tasks outside of the <strong>event loop</strong> on a libuv worker thread. Subclasses must implement this method and the method is run on a thread other than that running the main event loop. As the method is not running on the main event loop, it must avoid calling any methods from node-addon-api or running any code that might invoke JavaScript. Instead, once this method is complete any interaction through node-addon-api with JavaScript should be implemented in the <code>Napi::AsyncProgressWorker::OnOK</code> method and/or <code>Napi::AsyncProgressWorker::OnError</code> which run on the main thread and are invoked when the <code>Napi::AsyncProgressWorker::Execute</code> method completes.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">virtual</span> <span class="dt">void</span> Napi<span class="op">::</span>AsyncProgressWorker<span class="op">::</span>Execute<span class="op">(</span><span class="at">const</span> ExecutionProgress<span class="op">&amp;</span> progress<span class="op">)</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span></code></pre></div>
</section>
<section id="onok" class="level3">
<h3 class="anchored" data-anchor-id="onok">OnOK</h3>
<p>This method is invoked when the computation in the <code>Execute</code> method ends. The default implementation runs the <code>Callback</code> optionally provided when the <code>AsyncProgressWorker</code> class was created. The <code>Callback</code> will by default receive no arguments. Arguments to the callback can be provided by overriding the <code>GetResult()</code> method.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">virtual</span> <span class="dt">void</span> Napi<span class="op">::</span>AsyncProgressWorker<span class="op">::</span>OnOK<span class="op">();</span></span></code></pre></div>
</section>
<section id="onprogress" class="level3">
<h3 class="anchored" data-anchor-id="onprogress">OnProgress</h3>
<p>This method is invoked when the computation in the <code>Napi::AsyncProgressWorker::ExecutionProcess::Send</code> method was called during worker thread execution.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">virtual</span> <span class="dt">void</span> Napi<span class="op">::</span>AsyncProgressWorker<span class="op">::</span>OnProgress<span class="op">(</span><span class="at">const</span> T<span class="op">*</span> data<span class="op">,</span> <span class="dt">size_t</span> count<span class="op">)</span></span></code></pre></div>
</section>
<section id="constructor" class="level3">
<h3 class="anchored" data-anchor-id="constructor">Constructor</h3>
<p>Creates a new <code>Napi::AsyncProgressWorker</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">explicit</span> Napi<span class="op">::</span>AsyncProgressWorker<span class="op">(</span><span class="at">const</span> Napi<span class="op">::</span>Function<span class="op">&amp;</span> callback<span class="op">);</span></span></code></pre></div>
<ul>
<li><code>[in] callback</code>: The function which will be called when an asynchronous operations ends. The given function is called from the main event loop thread.</li>
</ul>
<p>Returns a <code>Napi::AsyncProgressWorker</code> instance which can later be queued for execution by calling <code>Napi::AsyncWork::Queue</code>.</p>
</section>
<section id="constructor-1" class="level3">
<h3 class="anchored" data-anchor-id="constructor-1">Constructor</h3>
<p>Creates a new <code>Napi::AsyncProgressWorker</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">explicit</span> Napi<span class="op">::</span>AsyncProgressWorker<span class="op">(</span><span class="at">const</span> Napi<span class="op">::</span>Function<span class="op">&amp;</span> callback<span class="op">,</span> <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> resource_name<span class="op">);</span></span></code></pre></div>
<ul>
<li><code>[in] callback</code>: The function which will be called when an asynchronous operations ends. The given function is called from the main event loop thread.</li>
<li><code>[in] resource_name</code>: Null-terminated string that represents the identifier for the kind of resource that is being provided for diagnostic information exposed by the async_hooks API.</li>
</ul>
<p>Returns a <code>Napi::AsyncProgressWorker</code> instance which can later be queued for execution by calling <code>Napi::AsyncWork::Queue</code>.</p>
</section>
<section id="constructor-2" class="level3">
<h3 class="anchored" data-anchor-id="constructor-2">Constructor</h3>
<p>Creates a new <code>Napi::AsyncProgressWorker</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">explicit</span> Napi<span class="op">::</span>AsyncProgressWorker<span class="op">(</span><span class="at">const</span> Napi<span class="op">::</span>Function<span class="op">&amp;</span> callback<span class="op">,</span> <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> resource_name<span class="op">,</span> <span class="at">const</span> Napi<span class="op">::</span>Object<span class="op">&amp;</span> resource<span class="op">);</span></span></code></pre></div>
<ul>
<li><code>[in] callback</code>: The function which will be called when an asynchronous operations ends. The given function is called from the main event loop thread.</li>
<li><code>[in] resource_name</code>: Null-terminated string that represents the identifier for the kind of resource that is being provided for diagnostic information exposed by the async_hooks API.</li>
<li><code>[in] resource</code>: Object associated with the asynchronous operation that will be passed to possible async_hooks.</li>
</ul>
<p>Returns a <code>Napi::AsyncProgressWorker</code> instance which can later be queued for execution by calling <code>Napi::AsyncWork::Queue</code>.</p>
</section>
<section id="constructor-3" class="level3">
<h3 class="anchored" data-anchor-id="constructor-3">Constructor</h3>
<p>Creates a new <code>Napi::AsyncProgressWorker</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">explicit</span> Napi<span class="op">::</span>AsyncProgressWorker<span class="op">(</span><span class="at">const</span> Napi<span class="op">::</span>Object<span class="op">&amp;</span> receiver<span class="op">,</span> <span class="at">const</span> Napi<span class="op">::</span>Function<span class="op">&amp;</span> callback<span class="op">);</span></span></code></pre></div>
<ul>
<li><code>[in] receiver</code>: The <code>this</code> object passed to the called function.</li>
<li><code>[in] callback</code>: The function which will be called when an asynchronous operations ends. The given function is called from the main event loop thread.</li>
</ul>
<p>Returns a <code>Napi::AsyncProgressWorker</code> instance which can later be queued for execution by calling <code>Napi::AsyncWork::Queue</code>.</p>
</section>
<section id="constructor-4" class="level3">
<h3 class="anchored" data-anchor-id="constructor-4">Constructor</h3>
<p>Creates a new <code>Napi::AsyncProgressWorker</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">explicit</span> Napi<span class="op">::</span>AsyncProgressWorker<span class="op">(</span><span class="at">const</span> Napi<span class="op">::</span>Object<span class="op">&amp;</span> receiver<span class="op">,</span> <span class="at">const</span> Napi<span class="op">::</span>Function<span class="op">&amp;</span> callback<span class="op">,</span> <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> resource_name<span class="op">);</span></span></code></pre></div>
<ul>
<li><code>[in] receiver</code>: The <code>this</code> object passed to the called function.</li>
<li><code>[in] callback</code>: The function which will be called when an asynchronous operations ends. The given function is called from the main event loop thread.</li>
<li><code>[in] resource_name</code>: Null-terminated string that represents the identifier for the kind of resource that is being provided for diagnostic information exposed by the async_hooks API.</li>
</ul>
<p>Returns a <code>Napi::AsyncWork</code> instance which can later be queued for execution by calling <code>Napi::AsyncWork::Queue</code>.</p>
</section>
<section id="constructor-5" class="level3">
<h3 class="anchored" data-anchor-id="constructor-5">Constructor</h3>
<p>Creates a new <code>Napi::AsyncProgressWorker</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">explicit</span> Napi<span class="op">::</span>AsyncProgressWorker<span class="op">(</span><span class="at">const</span> Napi<span class="op">::</span>Object<span class="op">&amp;</span> receiver<span class="op">,</span> <span class="at">const</span> Napi<span class="op">::</span>Function<span class="op">&amp;</span> callback<span class="op">,</span> <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> resource_name<span class="op">,</span> <span class="at">const</span> Napi<span class="op">::</span>Object<span class="op">&amp;</span> resource<span class="op">);</span></span></code></pre></div>
<ul>
<li><code>[in] receiver</code>: The <code>this</code> object to be passed to the called function.</li>
<li><code>[in] callback</code>: The function which will be called when an asynchronous operations ends. The given function is called from the main event loop thread.</li>
<li><code>[in] resource_name</code>: Null-terminated string that represents the identifier for the kind of resource that is being provided for diagnostic information exposed by the async_hooks API.</li>
<li><code>[in] resource</code>: Object associated with the asynchronous operation that will be passed to possible async_hooks.</li>
</ul>
<p>Returns a <code>Napi::AsyncWork</code> instance which can later be queued for execution by calling <code>Napi::AsyncWork::Queue</code>.</p>
</section>
<section id="constructor-6" class="level3">
<h3 class="anchored" data-anchor-id="constructor-6">Constructor</h3>
<p>Creates a new <code>Napi::AsyncProgressWorker</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">explicit</span> Napi<span class="op">::</span>AsyncProgressWorker<span class="op">(</span>Napi<span class="op">::</span>Env env<span class="op">);</span></span></code></pre></div>
<ul>
<li><code>[in] env</code>: The environment in which to create the <code>Napi::AsyncProgressWorker</code>.</li>
</ul>
<p>Returns an <code>Napi::AsyncProgressWorker</code> instance which can later be queued for execution by calling <code>Napi::AsyncProgressWorker::Queue</code>.</p>
<p>Available with <code>NAPI_VERSION</code> equal to or greater than 5.</p>
</section>
<section id="constructor-7" class="level3">
<h3 class="anchored" data-anchor-id="constructor-7">Constructor</h3>
<p>Creates a new <code>Napi::AsyncProgressWorker</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">explicit</span> Napi<span class="op">::</span>AsyncProgressWorker<span class="op">(</span>Napi<span class="op">::</span>Env env<span class="op">,</span> <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> resource_name<span class="op">);</span></span></code></pre></div>
<ul>
<li><code>[in] env</code>: The environment in which to create the <code>Napi::AsyncProgressWorker</code>.</li>
<li><code>[in] resource_name</code>: Null-terminated string that represents the identifier for the kind of resource that is being provided for diagnostic information exposed by the async_hooks API.</li>
</ul>
<p>Returns a <code>Napi::AsyncProgressWorker</code> instance which can later be queued for execution by calling <code>Napi::AsyncProgressWorker::Queue</code>.</p>
<p>Available with <code>NAPI_VERSION</code> equal to or greater than 5.</p>
</section>
<section id="constructor-8" class="level3">
<h3 class="anchored" data-anchor-id="constructor-8">Constructor</h3>
<p>Creates a new <code>Napi::AsyncProgressWorker</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">explicit</span> Napi<span class="op">::</span>AsyncProgressWorker<span class="op">(</span>Napi<span class="op">::</span>Env env<span class="op">,</span> <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> resource_name<span class="op">,</span> <span class="at">const</span> Napi<span class="op">::</span>Object<span class="op">&amp;</span> resource<span class="op">);</span></span></code></pre></div>
<ul>
<li><code>[in] env</code>: The environment in which to create the <code>Napi::AsyncProgressWorker</code>.</li>
<li><code>[in] resource_name</code>: Null-terminated string that represents the identifier for the kind of resource that is being provided for diagnostic information exposed by the async_hooks API.</li>
<li><code>[in] resource</code>: Object associated with the asynchronous operation that will be passed to possible async_hooks.</li>
</ul>
<p>Returns a <code>Napi::AsyncProgressWorker</code> instance which can later be queued for execution by calling <code>Napi::AsyncProgressWorker::Queue</code>.</p>
<p>Available with <code>NAPI_VERSION</code> equal to or greater than 5.</p>
</section>
<section id="destructor" class="level3">
<h3 class="anchored" data-anchor-id="destructor">Destructor</h3>
<p>Deletes the created work object that is used to execute logic asynchronously and release the internal <code>Napi::ThreadSafeFunction</code>, which will be aborted to prevent unexpected upcoming thread safe calls.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">virtual</span> Napi<span class="op">::</span>AsyncProgressWorker<span class="op">::~</span>AsyncProgressWorker<span class="op">();</span></span></code></pre></div>
</section>
</section>
</section>
<section id="asyncprogressworkerexecutionprocess" class="level1">
<h1>AsyncProgressWorker::ExecutionProcess</h1>
<p>A bridge class created before the worker thread execution of <code>Napi::AsyncProgressWorker::Execute</code>.</p>
<section id="methods-1" class="level2">
<h2 class="anchored" data-anchor-id="methods-1">Methods</h2>
<section id="send" class="level3">
<h3 class="anchored" data-anchor-id="send">Send</h3>
<p><code>Napi::AsyncProgressWorker::ExecutionProcess::Send</code> takes two arguments, a pointer to a generic type of data, and a <code>size_t</code> to indicate how many items the pointer is pointing to.</p>
<p>The data pointed to will be copied to internal slots of <code>Napi::AsyncProgressWorker</code> so after the call to <code>Napi::AsyncProgressWorker::ExecutionProcess::Send</code> the data can be safely released.</p>
<p>Note that <code>Napi::AsyncProgressWorker::ExecutionProcess::Send</code> merely guarantees <strong>eventual</strong> invocation of <code>Napi::AsyncProgressWorker::OnProgress</code>, which means multiple send might be coalesced into single invocation of <code>Napi::AsyncProgressWorker::OnProgress</code> with latest data.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> Napi<span class="op">::</span>AsyncProgressWorker<span class="op">::</span>ExecutionProcess<span class="op">::</span>Send<span class="op">(</span><span class="at">const</span> T<span class="op">*</span> data<span class="op">,</span> <span class="dt">size_t</span> count<span class="op">)</span> <span class="at">const</span><span class="op">;</span></span></code></pre></div>
</section>
</section>
<section id="example" class="level2">
<h2 class="anchored" data-anchor-id="example">Example</h2>
<p>The first step to use the <code>Napi::AsyncProgressWorker</code> class is to create a new class that inherits from it and implement the <code>Napi::AsyncProgressWorker::Execute</code> abstract method. Typically input to the worker will be saved within the class’ fields generally passed in through its constructor.</p>
<p>During the worker thread execution, the first argument of <code>Napi::AsyncProgressWorker::Execute</code> can be used to report the progress of the execution.</p>
<p>When the <code>Napi::AsyncProgressWorker::Execute</code> method completes without errors the <code>Napi::AsyncProgressWorker::OnOK</code> function callback will be invoked. In this function the results of the computation will be reassembled and returned back to the initial JavaScript context.</p>
<p><code>Napi::AsyncProgressWorker</code> ensures that all the code in the <code>Napi::AsyncProgressWorker::Execute</code> function runs in the background out of the <strong>event loop</strong> thread and at the end the <code>Napi::AsyncProgressWorker::OnOK</code> or <code>Napi::AsyncProgressWorker::OnError</code> function will be called and are executed as part of the event loop.</p>
<p>The code below shows a basic example of the <code>Napi::AsyncProgressWorker</code> implementation:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;napi.h&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;chrono&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;thread&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>use <span class="kw">namespace</span> Napi<span class="op">;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> EchoWorker <span class="op">:</span> <span class="kw">public</span> AsyncProgressWorker<span class="op">&lt;</span><span class="dt">uint32_t</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span><span class="op">:</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>        EchoWorker<span class="op">(</span>Function<span class="op">&amp;</span> callback<span class="op">,</span> <span class="bu">std::</span>string<span class="op">&amp;</span> echo<span class="op">)</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span> AsyncProgressWorker<span class="op">(</span>callback<span class="op">),</span> echo<span class="op">(</span>echo<span class="op">)</span> <span class="op">{}</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">~</span>EchoWorker<span class="op">()</span> <span class="op">{}</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// This code will be executed on the worker thread</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> Execute<span class="op">(</span><span class="at">const</span> ExecutionProgress<span class="op">&amp;</span> progress<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Need to simulate cpu heavy task</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">uint32_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">100</span><span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>          progress<span class="op">.</span>Send<span class="op">(&amp;</span>i<span class="op">,</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>          <span class="bu">std::</span>this_thread<span class="bu">::</span>sleep_for<span class="op">(</span><span class="bu">std::</span>chrono<span class="bu">::</span>seconds<span class="op">(</span><span class="dv">1</span><span class="op">));</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> OnOK<span class="op">()</span> <span class="op">{</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>        HandleScope scope<span class="op">(</span>Env<span class="op">());</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>        Callback<span class="op">().</span>Call<span class="op">({</span>Env<span class="op">().</span>Null<span class="op">(),</span> String<span class="op">::</span>New<span class="op">(</span>Env<span class="op">(),</span> echo<span class="op">)});</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> OnProgress<span class="op">(</span><span class="at">const</span> <span class="dt">uint32_t</span><span class="op">*</span> data<span class="op">,</span> <span class="dt">size_t</span> <span class="co">/* count */</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>        HandleScope scope<span class="op">(</span>Env<span class="op">());</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>        Callback<span class="op">().</span>Call<span class="op">({</span>Env<span class="op">().</span>Null<span class="op">(),</span> Env<span class="op">().</span>Null<span class="op">(),</span> Number<span class="op">::</span>New<span class="op">(</span>Env<span class="op">(),</span> <span class="op">*</span>data<span class="op">)});</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span><span class="op">:</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string<span class="op"> </span>echo<span class="op">;</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>The <code>EchoWorker</code>‘s constructor calls the base class’ constructor to pass in the callback that the <code>Napi::AsyncProgressWorker</code> base class will store persistently. When the work on the <code>Napi::AsyncProgressWorker::Execute</code> method is done the <code>Napi::AsyncProgressWorker::OnOk</code> method is called and the results are return back to JavaScript when the stored callback is invoked with its associated environment.</p>
<p>The following code shows an example of how to create and use an <code>Napi::AsyncProgressWorker</code></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;napi.h&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Include EchoWorker class</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">// ..</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>use <span class="kw">namespace</span> Napi<span class="op">;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>Value Echo<span class="op">(</span><span class="at">const</span> CallbackInfo<span class="op">&amp;</span> info<span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// We need to validate the arguments here</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    Function cb <span class="op">=</span> info<span class="op">[</span><span class="dv">1</span><span class="op">].</span>As<span class="op">&lt;</span>Function<span class="op">&gt;();</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string<span class="op"> </span>in <span class="op">=</span> info<span class="op">[</span><span class="dv">0</span><span class="op">].</span>As<span class="op">&lt;</span>String<span class="op">&gt;();</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    EchoWorker<span class="op">*</span> wk <span class="op">=</span> <span class="kw">new</span> EchoWorker<span class="op">(</span>cb<span class="op">,</span> in<span class="op">);</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    wk<span class="op">-&gt;</span>Queue<span class="op">();</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> info<span class="op">.</span>Env<span class="op">().</span>Undefined<span class="op">();</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The implementation of a <code>Napi::AsyncProgressWorker</code> can be used by creating a new instance and passing to its constructor the callback to execute when the asynchronous task ends and other data needed for the computation. Once created, the only other action needed is to call the <code>Napi::AsyncProgressWorker::Queue</code> method that will queue the created worker for execution.</p>


</section>
</section>
</main> <!-- /main -->
<script type="text/javascript">

// replace cmd keyboard shortcut w/ control on non-Mac platforms
const kPlatformMac = typeof navigator !== 'undefined' ? /Mac/.test(navigator.platform) : false;
if (!kPlatformMac) {
   var kbds = document.querySelectorAll("kbd")
   kbds.forEach(function(kbd) {
      kbd.innerHTML = kbd.innerHTML.replace(/⌘/g, '⌃');
   });
}

</script>
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Proudly supported by <a href="https://mvpworkshop.co"><img src="https://mvpworkshop.co/wp-content/uploads/2021/01/mvp-logo.png" class="img-fluid" width="65"></a></div>   
      <div class="nav-footer-center">
        <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../../../../../../../../about.html">About</a>
  </li>  
</ul>
      </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/3327_io">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/0x3327/research">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>


</body></html>