<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.9.64">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>3327 Research – error_handling</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <script src="../../../../../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="../../../../../../../../../site_libs/quarto-nav/headroom.min.js"></script>
  <script src="../../../../../../../../../site_libs/clipboard/clipboard.min.js"></script>
  <meta name="quarto:offset" content="../../../../../../../../../">
  <script src="../../../../../../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
  <script src="../../../../../../../../../site_libs/quarto-search/fuse.min.js"></script>
  <script src="../../../../../../../../../site_libs/quarto-search/quarto-search.js"></script>
  <link href="../../../../../../../../..//images/favicon.ico" rel="icon">
  <script src="../../../../../../../../../site_libs/quarto-html/quarto.js"></script>
  <script src="../../../../../../../../../site_libs/quarto-html/popper.min.js"></script>
  <script src="../../../../../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="../../../../../../../../../site_libs/quarto-html/anchor.min.js"></script>
  <link href="../../../../../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link href="../../../../../../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <script src="../../../../../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="../../../../../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="../../../../../../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <script id="quarto-search-options" type="application/json">{
    "location": "navbar",
    "copy-button": false,
    "collapse-after": 2,
    "panel-placement": "end",
    "type": "overlay",
    "limit": 20,
    "language": {
      "search-no-results-text": "No results",
      "search-matching-documents-text": "matching documents",
      "search-copy-link-title": "Copy link to search",
      "search-hide-matches-text": "Hide additional matches",
      "search-more-match-text": "more match in this document",
      "search-more-matches-text": "more matches in this document",
      "search-clear-button-title": "Clear",
      "search-detached-cancel-button-title": "Cancel",
      "search-submit-button-title": "Submit"
    }
  }</script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="../../../../../../../../../styles.css">
</head>
<body>
<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../../../../../../../../index.html">
    <img src="../../../../../../../../../logo.png" alt="">
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../../../../../../index.html">Overview</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../../../../../documents/research/index.html">Research</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/3327_io"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/0x3327/research"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
<h2 id="toc-title">On this page</h2>
<ul>
<li><a href="#error-handling" class="nav-link active" data-scroll-target="#error-handling">Error handling</a>
<ul class="collapse">
<li><a href="#handling-errors-with-c-exceptions" class="nav-link" data-scroll-target="#handling-errors-with-c-exceptions">Handling Errors With C++ Exceptions</a></li>
<li><a href="#examples-with-c-exceptions-enabled" class="nav-link" data-scroll-target="#examples-with-c-exceptions-enabled">Examples with C++ exceptions enabled</a>
<ul class="collapse">
<li><a href="#throwing-a-c-exception" class="nav-link" data-scroll-target="#throwing-a-c-exception">Throwing a C++ exception</a></li>
<li><a href="#propagating-a-n-api-c-exception" class="nav-link" data-scroll-target="#propagating-a-n-api-c-exception">Propagating a N-API C++ exception</a></li>
<li><a href="#handling-a-n-api-c-exception" class="nav-link" data-scroll-target="#handling-a-n-api-c-exception">Handling a N-API C++ exception</a></li>
</ul></li>
<li><a href="#handling-errors-without-c-exceptions" class="nav-link" data-scroll-target="#handling-errors-without-c-exceptions">Handling Errors Without C++ Exceptions</a></li>
<li><a href="#examples-with-c-exceptions-disabled" class="nav-link" data-scroll-target="#examples-with-c-exceptions-disabled">Examples with C++ exceptions disabled</a>
<ul class="collapse">
<li><a href="#throwing-a-js-exception" class="nav-link" data-scroll-target="#throwing-a-js-exception">Throwing a JS exception</a></li>
<li><a href="#propagating-a-n-api-js-exception" class="nav-link" data-scroll-target="#propagating-a-n-api-js-exception">Propagating a N-API JS exception</a></li>
<li><a href="#handling-a-n-api-js-exception" class="nav-link" data-scroll-target="#handling-a-n-api-js-exception">Handling a N-API JS exception</a></li>
</ul></li>
<li><a href="#calling-n-api-directly-from-a-node-addon-api-addon" class="nav-link" data-scroll-target="#calling-n-api-directly-from-a-node-addon-api-addon">Calling N-API directly from a <strong>node-addon-api</strong> addon</a>
<ul class="collapse">
<li><a href="#napi_throwe-..." class="nav-link" data-scroll-target="#napi_throwe-..."><code>NAPI_THROW(e, ...)</code></a></li>
<li><a href="#napi_throw_if_failedenv-status-..." class="nav-link" data-scroll-target="#napi_throw_if_failedenv-status-..."><code>NAPI_THROW_IF_FAILED(env, status, ...)</code></a></li>
<li><a href="#napi_throw_if_failed_voidenv-status" class="nav-link" data-scroll-target="#napi_throw_if_failed_voidenv-status"><code>NAPI_THROW_IF_FAILED_VOID(env, status)</code></a></li>
<li><a href="#napi_fatal_if_failedstatus-location-message" class="nav-link" data-scroll-target="#napi_fatal_if_failedstatus-location-message"><code>NAPI_FATAL_IF_FAILED(status, location, message)</code></a></li>
</ul></li>
</ul></li>
</ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/0x3327/research/edit/main/documents/research/assets/ERFC-42/research_examples/hardhat-test-example/node_modules/node-addon-api/doc/error_handling.md" class="toc-action">Edit this page</a></p><p><a href="https://github.com/0x3327/research/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<section id="error-handling" class="level1">
<h1>Error handling</h1>
<p>Error handling represents one of the most important considerations when implementing a Node.js native add-on. When an error occurs in your C++ code you have to handle and dispatch it correctly. <strong>node-addon-api</strong> uses return values and JavaScript exceptions for error handling. You can choose return values or exception handling based on the mechanism that works best for your add-on.</p>
<p>The <code>Napi::Error</code> is a persistent reference (for more info see: <a href="../../../../../../../../../documents/research/assets/ERFC-42/research_examples/hardhat-test-example/node_modules/node-addon-api/doc/object_reference.html"><code>Napi::ObjectReference</code></a>) to a JavaScript error object. Use of this class depends on whether C++ exceptions are enabled at compile time.</p>
<p>If C++ exceptions are enabled (for more info see: <a href="../../../../../../../../../documents/research/assets/ERFC-42/research_examples/hardhat-test-example/node_modules/node-addon-api/doc/setup.html">Setup</a>), then the <code>Napi::Error</code> class extends <code>std::exception</code> and enables integrated error-handling for C++ exceptions and JavaScript exceptions.</p>
<p>The following sections explain the approach for each case:</p>
<ul>
<li><a href="#exceptions">Handling Errors With C++ Exceptions</a></li>
<li><a href="#noexceptions">Handling Errors Without C++ Exceptions</a></li>
</ul>
<p><a name="exceptions"></a></p>
<p>In most cases when an error occurs, the addon should do whatever clean is possible and then return to JavaScript so that they error can be propagated. In less frequent cases the addon may be able to recover from the error, clear the error and then continue.</p>
<section id="handling-errors-with-c-exceptions" class="level2">
<h2 class="anchored" data-anchor-id="handling-errors-with-c-exceptions">Handling Errors With C++ Exceptions</h2>
<p>When C++ exceptions are enabled try/catch can be used to catch exceptions thrown from calls to JavaScript and then they can either be handled or rethrown before returning from a native method.</p>
<p>If a node-addon-api call fails without executing any JavaScript code (for example due to an invalid argument), then node-addon-api automatically converts and throws the error as a C++ exception of type <code>Napi::Error</code>.</p>
<p>If a JavaScript function called by C++ code via node-addon-api throws a JavaScript exception, then node-addon-api automatically converts and throws it as a C++ exception of type <code>Napi:Error</code> on return from the JavaScript code to the native method.</p>
<p>If a C++ exception of type <code>Napi::Error</code> escapes from a N-API C++ callback, then the N-API wrapper automatically converts and throws it as a JavaScript exception.</p>
<p>On return from a native method, node-addon-api will automatically convert a pending C++ exception to a JavaScript exception.</p>
<p>When C++ exceptions are enabled try/catch can be used to catch exceptions thrown from calls to JavaScript and then they can either be handled or rethrown before returning from a native method.</p>
</section>
<section id="examples-with-c-exceptions-enabled" class="level2">
<h2 class="anchored" data-anchor-id="examples-with-c-exceptions-enabled">Examples with C++ exceptions enabled</h2>
<section id="throwing-a-c-exception" class="level3">
<h3 class="anchored" data-anchor-id="throwing-a-c-exception">Throwing a C++ exception</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>Env env <span class="op">=</span> <span class="op">...</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">throw</span> Napi<span class="op">::</span>Error<span class="op">::</span>New<span class="op">(</span>env<span class="op">,</span> <span class="st">"Example exception"</span><span class="op">);</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">// other C++ statements</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span></code></pre></div>
<p>The statements following the throw statement will not be executed. The exception will bubble up as a C++ exception of type <code>Napi::Error</code>, until it is either caught while still in C++, or else automatically propagated as a JavaScript exception when returning to JavaScript.</p>
</section>
<section id="propagating-a-n-api-c-exception" class="level3">
<h3 class="anchored" data-anchor-id="propagating-a-n-api-c-exception">Propagating a N-API C++ exception</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Napi<span class="op">::</span>Function jsFunctionThatThrows <span class="op">=</span> someObj<span class="op">.</span>As<span class="op">&lt;</span>Napi<span class="op">::</span>Function<span class="op">&gt;();</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>Napi<span class="op">::</span>Value result <span class="op">=</span> jsFunctionThatThrows<span class="op">({</span> arg1<span class="op">,</span> arg2 <span class="op">});</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">// other C++ statements</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span></code></pre></div>
<p>The C++ statements following the call to the JavaScript function will not be executed. The exception will bubble up as a C++ exception of type <code>Napi::Error</code>, until it is either caught while still in C++, or else automatically propagated as a JavaScript exception when returning to JavaScript.</p>
</section>
<section id="handling-a-n-api-c-exception" class="level3">
<h3 class="anchored" data-anchor-id="handling-a-n-api-c-exception">Handling a N-API C++ exception</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Napi<span class="op">::</span>Function jsFunctionThatThrows <span class="op">=</span> someObj<span class="op">.</span>As<span class="op">&lt;</span>Napi<span class="op">::</span>Function<span class="op">&gt;();</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>Napi<span class="op">::</span>Value result<span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> <span class="op">{</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> jsFunctionThatThrows<span class="op">({</span> arg1<span class="op">,</span> arg2 <span class="op">});</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">catch</span> <span class="op">(</span><span class="at">const</span> Error<span class="op">&amp;</span> e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    cerr <span class="op">&lt;&lt;</span> <span class="st">"Caught JavaScript exception: "</span> <span class="op">+</span> e<span class="op">.</span>what<span class="op">();</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Since the exception was caught here, it will not be propagated as a JavaScript exception.</p>
<p><a name="noexceptions"></a></p>
</section>
</section>
<section id="handling-errors-without-c-exceptions" class="level2">
<h2 class="anchored" data-anchor-id="handling-errors-without-c-exceptions">Handling Errors Without C++ Exceptions</h2>
<p>If C++ exceptions are disabled (for more info see: <a href="../../../../../../../../../documents/research/assets/ERFC-42/research_examples/hardhat-test-example/node_modules/node-addon-api/doc/setup.html">Setup</a>), then the <code>Napi::Error</code> class does not extend <code>std::exception</code>. This means that any calls to node-addon-api function do not throw a C++ exceptions. Instead, it raises <em>pending</em> JavaScript exceptions and returns an <em>empty</em> <code>Napi::Value</code>. The calling code should check <code>env.IsExceptionPending()</code> before attempting to use a returned value, and may use methods on the <code>Napi::Env</code> class to check for, get, and clear a pending JavaScript exception (for more info see: <a href="../../../../../../../../../documents/research/assets/ERFC-42/research_examples/hardhat-test-example/node_modules/node-addon-api/doc/env.html">Env</a>). If the pending exception is not cleared, it will be thrown when the native code returns to JavaScript.</p>
</section>
<section id="examples-with-c-exceptions-disabled" class="level2">
<h2 class="anchored" data-anchor-id="examples-with-c-exceptions-disabled">Examples with C++ exceptions disabled</h2>
<section id="throwing-a-js-exception" class="level3">
<h3 class="anchored" data-anchor-id="throwing-a-js-exception">Throwing a JS exception</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Napi<span class="op">::</span>Env env <span class="op">=</span> <span class="op">...</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Napi<span class="op">::</span>Error<span class="op">::</span>New<span class="op">(</span>env<span class="op">,</span> <span class="st">"Example exception"</span><span class="op">).</span>ThrowAsJavaScriptException<span class="op">();</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span><span class="op">;</span></span></code></pre></div>
<p>After throwing a JavaScript exception, the code should generally return immediately from the native callback, after performing any necessary cleanup.</p>
</section>
<section id="propagating-a-n-api-js-exception" class="level3">
<h3 class="anchored" data-anchor-id="propagating-a-n-api-js-exception">Propagating a N-API JS exception</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>Napi<span class="op">::</span>Env env <span class="op">=</span> <span class="op">...</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>Napi<span class="op">::</span>Function jsFunctionThatThrows <span class="op">=</span> someObj<span class="op">.</span>As<span class="op">&lt;</span>Napi<span class="op">::</span>Function<span class="op">&gt;();</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>Napi<span class="op">::</span>Value result <span class="op">=</span> jsFunctionThatThrows<span class="op">({</span> arg1<span class="op">,</span> arg2 <span class="op">});</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>env<span class="op">.</span>IsExceptionPending<span class="op">())</span> <span class="op">{</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    Error e <span class="op">=</span> env<span class="op">.</span>GetAndClearPendingException<span class="op">();</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> e<span class="op">.</span>Value<span class="op">();</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>If env.IsExceptionPending() returns true a JavaScript exception is pending. To let the exception propagate, the code should generally return immediately from the native callback, after performing any necessary cleanup.</p>
</section>
<section id="handling-a-n-api-js-exception" class="level3">
<h3 class="anchored" data-anchor-id="handling-a-n-api-js-exception">Handling a N-API JS exception</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>Napi<span class="op">::</span>Env env <span class="op">=</span> <span class="op">...</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>Napi<span class="op">::</span>Function jsFunctionThatThrows <span class="op">=</span> someObj<span class="op">.</span>As<span class="op">&lt;</span>Napi<span class="op">::</span>Function<span class="op">&gt;();</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>Napi<span class="op">::</span>Value result <span class="op">=</span> jsFunctionThatThrows<span class="op">({</span> arg1<span class="op">,</span> arg2 <span class="op">});</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>env<span class="op">.</span>IsExceptionPending<span class="op">())</span> <span class="op">{</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    Napi<span class="op">::</span>Error e <span class="op">=</span> env<span class="op">.</span>GetAndClearPendingException<span class="op">();</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    cerr <span class="op">&lt;&lt;</span> <span class="st">"Caught JavaScript exception: "</span> <span class="op">+</span> e<span class="op">.</span>Message<span class="op">();</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Since the exception was cleared here, it will not be propagated as a JavaScript exception after the native callback returns.</p>
</section>
</section>
<section id="calling-n-api-directly-from-a-node-addon-api-addon" class="level2">
<h2 class="anchored" data-anchor-id="calling-n-api-directly-from-a-node-addon-api-addon">Calling N-API directly from a <strong>node-addon-api</strong> addon</h2>
<p><strong>node-addon-api</strong> provides macros for throwing errors in response to non-OK <code>napi_status</code> results when calling <a href="https://nodejs.org/docs/latest/api/n-api.html">N-API</a> functions from within a native addon. These macros are defined differently depending on whether C++ exceptions are enabled or not, but are available for use in either case.</p>
<section id="napi_throwe-..." class="level3">
<h3 class="anchored" data-anchor-id="napi_throwe-..."><code>NAPI_THROW(e, ...)</code></h3>
<p>This macro accepts a <code>Napi::Error</code>, throws it, and returns the value given as the last parameter. If C++ exceptions are enabled (by defining <code>NAPI_CPP_EXCEPTIONS</code> during the build), the return value will be ignored.</p>
</section>
<section id="napi_throw_if_failedenv-status-..." class="level3">
<h3 class="anchored" data-anchor-id="napi_throw_if_failedenv-status-..."><code>NAPI_THROW_IF_FAILED(env, status, ...)</code></h3>
<p>This macro accepts a <code>Napi::Env</code> and a <code>napi_status</code>. It constructs an error from the <code>napi_status</code>, throws it, and returns the value given as the last parameter. If C++ exceptions are enabled (by defining <code>NAPI_CPP_EXCEPTIONS</code> during the build), the return value will be ignored.</p>
</section>
<section id="napi_throw_if_failed_voidenv-status" class="level3">
<h3 class="anchored" data-anchor-id="napi_throw_if_failed_voidenv-status"><code>NAPI_THROW_IF_FAILED_VOID(env, status)</code></h3>
<p>This macro accepts a <code>Napi::Env</code> and a <code>napi_status</code>. It constructs an error from the <code>napi_status</code>, throws it, and returns.</p>
</section>
<section id="napi_fatal_if_failedstatus-location-message" class="level3">
<h3 class="anchored" data-anchor-id="napi_fatal_if_failedstatus-location-message"><code>NAPI_FATAL_IF_FAILED(status, location, message)</code></h3>
<p>This macro accepts a <code>napi_status</code>, a C string indicating the location where the error occurred, and a second C string for the message to display.</p>


</section>
</section>
</section>
</main> <!-- /main -->
<script type="text/javascript">

// replace cmd keyboard shortcut w/ control on non-Mac platforms
const kPlatformMac = typeof navigator !== 'undefined' ? /Mac/.test(navigator.platform) : false;
if (!kPlatformMac) {
   var kbds = document.querySelectorAll("kbd")
   kbds.forEach(function(kbd) {
      kbd.innerHTML = kbd.innerHTML.replace(/⌘/g, '⌃');
   });
}

</script>
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Proudly supported by <a href="https://mvpworkshop.co"><img src="https://mvpworkshop.co/wp-content/uploads/2021/01/mvp-logo.png" class="img-fluid" width="65"></a></div>   
      <div class="nav-footer-center">
        <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../../../../../../../../about.html">About</a>
  </li>  
</ul>
      </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/3327_io">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/0x3327/research">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>


</body></html>