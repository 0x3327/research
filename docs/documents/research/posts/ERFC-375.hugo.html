<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.163">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Marija Mikic">
<meta name="dcterms.date" content="2022-08-23">

<title>3327 Research - [ERFC - 375] Anonymity in MACI</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../..//images/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>
    .quarto-title-block .quarto-title-banner {
      background: #EDF3F9;
    }
    </style>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="3327 Research - [ERFC - 375] Anonymity in MACI">
<meta property="og:description" content="MACI - Minimal Anti-Collusion Infrastructure is a collection of smart contracts, ZK circuits and ts packages that we can use to build programs on top.">
<meta property="og:site-name" content="3327 Research">
<meta name="twitter:title" content="3327 Research - [ERFC - 375] Anonymity in MACI">
<meta name="twitter:description" content="MACI - Minimal Anti-Collusion Infrastructure is a collection of smart contracts, ZK circuits and ts packages that we can use to build programs on top.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../logo.png" alt="" class="navbar-logo">
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html">Overview</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../documents/research/index.html">Research</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/3327_io"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/0x3327/research"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">[ERFC - 375] Anonymity in MACI</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Marija Mikic </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 23, 2022</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#executive-summary" id="toc-executive-summary" class="nav-link active" data-scroll-target="#executive-summary">Executive Summary</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#goals-methodology" id="toc-goals-methodology" class="nav-link" data-scroll-target="#goals-methodology">Goals &amp; Methodology</a>
  <ul class="collapse">
  <li><a href="#asymmetric-encryption" id="toc-asymmetric-encryption" class="nav-link" data-scroll-target="#asymmetric-encryption">Asymmetric encryption</a>
  <ul class="collapse">
  <li><a href="#ecdh-encryption" id="toc-ecdh-encryption" class="nav-link" data-scroll-target="#ecdh-encryption">ECDH encryption</a></li>
  <li><a href="#encryption-in-maci" id="toc-encryption-in-maci" class="nav-link" data-scroll-target="#encryption-in-maci">Encryption in MACI</a></li>
  <li><a href="#ec-elgamal-encryption" id="toc-ec-elgamal-encryption" class="nav-link" data-scroll-target="#ec-elgamal-encryption">EC ElGamal encryption</a></li>
  </ul></li>
  <li><a href="#re-randomization" id="toc-re-randomization" class="nav-link" data-scroll-target="#re-randomization">Re-randomization</a></li>
  <li><a href="#nullifier" id="toc-nullifier" class="nav-link" data-scroll-target="#nullifier">Nullifier</a></li>
  </ul></li>
  <li><a href="#results-discussion" id="toc-results-discussion" class="nav-link" data-scroll-target="#results-discussion">Results &amp; Discussion</a>
  <ul class="collapse">
  <li><a href="#protocol" id="toc-protocol" class="nav-link" data-scroll-target="#protocol">Protocol</a>
  <ul class="collapse">
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#bibliography" id="toc-bibliography" class="nav-link" data-scroll-target="#bibliography">Bibliography</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/0x3327/research/edit/main/documents/research/posts/ERFC-375.hugo.md" class="toc-action">Edit this page</a></p><p><a href="https://github.com/0x3327/research/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="executive-summary" class="level1">
<h1>Executive Summary</h1>
<p>MACI - Minimal Anti-Collusion Infrastructure is a collection of smart contracts, ZK circuits and ts packages that we can use to build programs on top. We have already dealt with this topic, we summarized what has been done in MACI so far. More information about MACI can be found in our previous research (MACI [1]) and blog (Can MACI really destroy the collusion? [2]).</p>
<p>This research is a continuation of the previous one, but with the aim of improving MACI. Namely, the problem that we saw as “burning” in MACI is that the coordinator can see how which voter voted. There is no problem if the coordinator is honest, but what if he is not?!</p>
<p>This research solves exactly that problem, i.e.&nbsp;prevents the coordinator from connecting the vote it processes with the voter itself. In this way, the anonymity of voting is completely preserved.</p>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In order to remove the “burning” problem and fully ensure the privacy of voting, we need to mention the most important components that currently perform encryption-decryption in MACI, as well as the way in which it is achieved.</p>
<p>Voters vote using MACI smart contracts. Before sending their vote to the blockchain, they first encrypt their vote (actually, they encrypt the signature and the command (which contains a couple of components, one of which is the option they voted for)) using a shared key. They use an Elliptic-curve Diffie–Hellman shared key. Voters send this encrypted message to the MACI smart contract and it will be stored on-chain. Using shared keys, the coordinator decrypts each vote. It should be noted that each voter will have a different shared key, and that only the voter and the coordinator know that key.</p>
<p>As it is always easier to understand the matter if there is a visualization, the image below shows the way encryption-decryption works in MACI.</p>
<p><img src="../assets/ERFC-375/MACI_A1.png"></p>
<p>After decryption, the coordinator needs to prove that voting was valid and reveal the results of voting. This should be done in the way that everyone is sure in the voting results, without releasing the vote of every individual. In order that the coordinator fulfill both of the above conditions, he will make ZK proofs. In this way, the anonymity of voting is almost completely preserved, up to the coordinator.</p>
<p>Our recommendations for interesting articles about MACI:</p>
<ul>
<li>MACI research [1];</li>
<li>Can MACI really destroy the collusion? [2];</li>
<li>Release Announcement: MACI 1.0 [3];</li>
<li>A Technical Introduction to MACI 1.0 [4].</li>
</ul>
</section>
<section id="goals-methodology" class="level1">
<h1>Goals &amp; Methodology</h1>
<p>As we already stated in the lines above, the intention of this research is to examine the possibilities and try to find a solution that would nullify the possibility of collusion in MACI. Namely, everything is hidden on-chain at the moment, but we want that coordinator not to know which user took what action.</p>
<p>Our proposal is to use ElGamal encryption and re-randomization. The main motivation for this is the article authored by Kobi Gurkan (MACI anonymization - using rerandomizable encryption [8]).</p>
<p>This potential improvement would have enormous implications for rooting out collusion. It is extremely important for the ecosystem to be able to use a decentralized voting system that is completely resistant to collusion. In the first place, it is important to protect the privacy of a certain voter in every sense (on-chain and off-chain). On the other hand, as MACI can be seen to be in use by the clr.fund, where users can vote which projects will receive funding, and for this reason the importance of this potential improvement can be additionally seen.</p>
<p>Therefore, in the future MACI would represent the most perfect system for voting in a decentralized system - a system completely resistant to collusion.</p>
<p>To be able to present the idea clearly, we need to explain how encryption works. In the following lines, we will first explain how ECDH encryption works, and how ElGamal encryption works.</p>
<section id="asymmetric-encryption" class="level2">
<h2 class="anchored" data-anchor-id="asymmetric-encryption">Asymmetric encryption</h2>
<p>The creators of asymmetric cryptography are Whitefield Diffie and Martin Hellman, who in 1976. described the idea of cryptography based on two keys: private (secret) and public key.</p>
<p>The difference between symmetric and asymmetric algorithms is that symmetric algorithms use the same key for encryption and decryption, while asymmetric algorithms use different keys for encryption and decryption. Information encrypted with a public key can only be decrypted with a private key, that can only the person who owns the private asymmetric key.</p>
<p><img src="../assets/ERFC-375/Asymmetric.png"></p>
<section id="ecdh-encryption" class="level3">
<h3 class="anchored" data-anchor-id="ecdh-encryption">ECDH encryption</h3>
<p>ECDH is very similar to the DHKE (Diffie–Hellman Key Exchange) algorithm, but it uses ECC point multiplication (consecutive addition). Our recommendation for literature related to elliptic curves in cryptography is Pairings for beginners [9].</p>
<p>ECDH allows two parties, each having an elliptic curve public–private key pair, to establish a shared key. Let <span class="math inline">\(G\)</span> be a generator point on the elliptic curve over a finite field <span class="math inline">\(F_p\)</span> (where <span class="math inline">\(p\)</span> is a prime number). Let <span class="math inline">\(pr_A\)</span> and <span class="math inline">\(pr_B\)</span> be the private keys of two different people <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>. Then <span class="math inline">\(pub_A = pr_A * G\)</span> and <span class="math inline">\(pub_B = pr_B * G\)</span> are their public keys. ECDH is based on the property of elliptic curve points:</p>
<p><span class="math inline">\((pr_A * G) * pr_B = pub_A * pr_B = shared key = pub_B * pr_A = (pr_B * G) * pr_A\)</span>.</p>
<p>In this way, both of them know the shared key, and they get it using their private key and the other person’s public key. In this way, each person’s private key remains secret.</p>
<p>The security of the algorithm lies in the difficulty of calculating the discrete logarithm.</p>
</section>
<section id="encryption-in-maci" class="level3">
<h3 class="anchored" data-anchor-id="encryption-in-maci">Encryption in MACI</h3>
<p>Now, we want to show in practice how ECDH works in MACI. First, we start with encryption. The image below shows an encryption template written in Circom (Circom [10]). In order to generate a shared key, the voter will enter as inputs: his private key and the public key of the coordinator (which is available for everyone). As you can see the output of this template will be a shared key.</p>
<p><img src="../assets/ERFC-375/Ec.png"></p>
<p>In order to process all the votes after the voting is over and to prove (to make ZK proof) that voting was regular (and announce the outcome of the voting), the coordinator needs to decrypt each vote. To achieve this, the coordinator uses the Decrypt(N) template which can be seen below. Namely, as inputs he enters a message and a shared key (marked as private_key in the code). As an output, he can read the message, i.e.&nbsp;he can see who voted (because the public key will be visible to him) as well as the option for which the voter with that public key voted.</p>
<p><img src="../assets/ERFC-375/De.png"></p>
<p>In order for the coordinator to update the State tree, he must read each vote (in that template). The picture below shows what it looks like. In lines 114-117, the coordinator, using his private key and public key of the voter as inputs (using the Ecdh template), derives the shared key. Then in lines 119-127 coordinator decrypts the message (from the voter) using the Decrypt template. Its input data is the shared key that he obtained in lines 114-117 and the encrypted message. The decrypt_comand_out variable contains the decrypted message that the coordinator can read.</p>
<p><img src="../assets/ERFC-375/State.png"></p>
</section>
<section id="ec-elgamal-encryption" class="level3">
<h3 class="anchored" data-anchor-id="ec-elgamal-encryption">EC ElGamal encryption</h3>
<p>In 1985, Taher Elgamal created an asymmetric cryptographic algorithm based on the Diffie-Hellman key exchange. Similar to the ECDH algorithm, the security of ElGamal is based on the difficult or almost impossible computation of the discrete logarithm of a large prime number.</p>
<p>Let <span class="math inline">\(G\)</span> be a generator point on the elliptic curve over a finite field <span class="math inline">\(F_p\)</span> (where <span class="math inline">\(p\)</span> is a prime number). Let <span class="math inline">\(pr_A\)</span> and <span class="math inline">\(pr_B\)</span> be the private keys of two different people <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>. Then <span class="math inline">\(pub_A = a * G\)</span> and <span class="math inline">\(pub_B = b * G\)</span> are their public keys. Let person <span class="math inline">\(A\)</span> be the person who will encrypt the data. For this purpose, person <span class="math inline">\(A\)</span> should do the following:</p>
<ol type="1">
<li><p>choose an arbitrary <span class="math inline">\(x\)</span> from the interval <span class="math inline">\((1,p)\)</span>;</p></li>
<li><p>calculate <span class="math inline">\(x * G =: X\)</span>;</p></li>
<li><p>assigns a point on the elliptic curve <span class="math inline">\(M(m,y)\)</span> to the message <span class="math inline">\(m\)</span>, where person <span class="math inline">\(A\)</span> choose <span class="math inline">\(y\)</span> so that the point <span class="math inline">\(M\)</span> is a point on the elliptic curve;</p></li>
<li><p>calculate <span class="math inline">\(Me := M + pub_B * x\)</span>;</p></li>
<li><p>send <span class="math inline">\(Me\)</span> and <span class="math inline">\(X\)</span> to person <span class="math inline">\(B\)</span>.</p></li>
</ol>
<p>Person <span class="math inline">\(B\)</span> needs to decrypt the data. For this purpose, person <span class="math inline">\(B\)</span> should do the following:</p>
<ol type="1">
<li><p>calculate <span class="math inline">\(pub_B * x == pr_B * G * x == pr_B * X\)</span>;</p></li>
<li><p>decrypts the message <span class="math inline">\(M(m,y) == Me - pub_B * x\)</span>;</p></li>
</ol>
<p>Note that when encrypting a message, person <span class="math inline">\(A\)</span> needs to know the public key of person <span class="math inline">\(B\)</span>, while person <span class="math inline">\(B\)</span> can decrypt the message without knowing the public key of person <span class="math inline">\(A\)</span> (which is not possible with decryption that relies on a shared key, i.e.&nbsp;ECDH).</p>
</section>
</section>
<section id="re-randomization" class="level2">
<h2 class="anchored" data-anchor-id="re-randomization">Re-randomization</h2>
<p>We usually use re-randomization when we want to convey the same message, but two cipher texts cannot be connected to each other. That function randomizes an existing cipher text such that it’s still decryptable under the original public key it was encrypted for.</p>
<p>Suppose we are working with the same elliptic curve. Assume that the notation we used above holds. We want the input parameters to be <span class="math inline">\(X\)</span> and <span class="math inline">\(Me\)</span> and the output parameters to be <span class="math inline">\(X_1\)</span> and <span class="math inline">\(Me_1\)</span> to hide the same message.</p>
<p>For this purpose, person <span class="math inline">\(A\)</span> should do the following:</p>
<ol type="1">
<li><p>choose an arbitrary <span class="math inline">\(z\)</span> from the interval <span class="math inline">\((1,p)\)</span>;</p></li>
<li><p>calculate <span class="math inline">\(X1 :=z * G + X\)</span>;</p></li>
<li><p>calculate <span class="math inline">\(Me_1 := Me + pub_B * z\)</span>;</p></li>
<li><p>output <span class="math inline">\(Me_1\)</span> and <span class="math inline">\(X_1\)</span>.</p></li>
</ol>
</section>
<section id="nullifier" class="level2">
<h2 class="anchored" data-anchor-id="nullifier">Nullifier</h2>
<p>In the following, we will use nullifier, so for the convenience of the reader, we will define it.</p>
<p>The nullifier is a unique ID that is in connection with the commitment and the ZKP proves the connection, but nobody knows which nullifier is assigned to which commitment.</p>
</section>
</section>
<section id="results-discussion" class="level1">
<h1>Results &amp; Discussion</h1>
<p>In order to achieve complete voter anonymity, we created required building blocks. Codes for ElGamal encryption, decryption and re-randomization are written in circom language. Below is the code for encryption, but all codes are available on github [12].</p>
<p>Code for encryption:</p>
<p><img src="../assets/ERFC-375/ElGamalEncryption.png"></p>
<p>The decryption and rerandomization codes existed in a different form and can be viewed in [11].</p>
<p>In order to take advantage of this, the current MACI protocol needs to be modified. Here we will only give an idea of what needs to be done to achieve the desired goal.</p>
<section id="protocol" class="level2">
<h2 class="anchored" data-anchor-id="protocol">Protocol</h2>
<p>In order to achieve the desired result, it is necessary to change the protocol. The current protocol, as we said before, allows the voter to vote and to change the public key (voter can send two types of message). For example, If the voter is blackmailed, he can create a command with the content of the option he wants to vote for and with a new public key. He can sign it with his previous public key, encrypts it (using ECDH encryption) and submits it to the MACI smart contracts. However, the same voter can then vote for the option the blackmailer wants, without that vote being valid (which the blackmailer will not know). How does it achieve this? The voter creates a command with the content of the option the blackmailer wants and the previous public key. He signs it with his previous public key, encrypts it (using ECDH encryption) and submits it to the MACI smart contracts. When the voting is over, the coordinator decrypts the first message, validates the signature, records this vote (because it is valid) and updates the voter’s public key. Then the coordinator decrypts the second message, sees that the signature does not match the new public key and therefore this message is invalid. But the voter can decrypt this message too, as proof of his vote for option blackmailer wants.</p>
<p>We want to preserve these two nice features: first, that the voter can prove to the blackmailer that he voted for that option for which he was blackmailed (without that vote being valid), and second, that all votes are encrypted and stored on-chain. But we also want to add a feature, so that the coordinator does not know which option the voter voted for. In the current protocol, when a voter’s public key is changed, the coordinator knows that the change has occurred and from there coordinator knows how the voter voted (although the public key change helped the voter to deceive the blackmailer).</p>
<p>As we do not want that coordinator to know who is the “owner” of the new public key, we need to disable the coordinator from seeing the link between the old and new public key of the voter. In order to achieve this, it is necessary for the voter to prove (he needs to make ZK proof) that owns the private key for the old public key and to be able to create a new public key based on that. For this purpose, we will need to create a set that will contain all deactivated public keys and his encrypted states. But here we have to be careful, we have to make sure that based on the previous public key, the voter can create exactly one new public key. For this reason we will need nullifiers and the set where we store them. Conclusion, we will need two new sets that we haven’t had so far. Let’s mark the first of them with <span class="math inline">\(D\)</span> and the second with <span class="math inline">\(N\)</span>. Set <span class="math inline">\(D\)</span> is public, while set <span class="math inline">\(N\)</span> is private. Also, we must expand the set of states, more precisely, in that set there should be a field that says whether the voter’s public key is active or inactive.</p>
<p>Also, we will need two new message types. The first type of message should be to deactivate the old public key. After deactivation, the coordinator adds the old public key with its encrypted state (using ElGamal encryption) to set <span class="math inline">\(D\)</span>.</p>
<p>Second type of message is that the voter creates a new public key proving that he is the owner of the old one. To achieve this, the voter needs to make a ZK proof that the element (old public key of voter, (<span class="math inline">\(X\)</span>, <span class="math inline">\(Me\)</span>)) belongs to the set <span class="math inline">\(D\)</span>, where (<span class="math inline">\(X\)</span>, <span class="math inline">\(Me\)</span>) is the ElGamal encrypted message, as well he need to prove that he knows the private key for the old public key. Also the output of the circuit should be (<span class="math inline">\(X_1\)</span>, <span class="math inline">\(Me_1\)</span>) which are obtained by rerandomization (<span class="math inline">\(X\)</span>, <span class="math inline">\(Me\)</span>) and nullifier which is the hash of the private key. The content of the message itself should be: (<span class="math inline">\(X1\)</span>, <span class="math inline">\(Me_1\)</span>), nullifier, the ZK proof and the new public key. Of course the message is encrypted. The coordinator decrypts the message, if the proof is valid, the nullifier doesn’t already exist in the set <span class="math inline">\(N\)</span>, places the nullifier in the set <span class="math inline">\(N\)</span>, adds a new public key and updates its state. Note that in this way the coordinator does not know the old public key of the voter whose vote he is processing. In this way, complete anonymity of voting was achieved.</p>
<section id="example" class="level3">
<h3 class="anchored" data-anchor-id="example">Example</h3>
<p>We now want to illustrate the entire protocol with an example. We want a person <span class="math inline">\(A\)</span> to be a voter. Person <span class="math inline">\(A\)</span> wants to prove to the blackmailer that she voted for option 1, even though she will vote for option 2. Also, person <span class="math inline">\(A\)</span> wants the coordinator not to know which option she voted for. Person <span class="math inline">\(A\)</span> can do it for example like this.</p>
<ol type="1">
<li><p>Person <span class="math inline">\(A\)</span> accesses the vote with public key 1. Votes for option 2, changes the public key to public key 2, signs the command with public key 1, and encrypts using ElGamal encryption.</p></li>
<li><p>Person <span class="math inline">\(A\)</span> then votes for option 1 and signs the vote with public key 1 and encrypts using ElGamal encryption.</p></li>
<li><p>Person <span class="math inline">\(A\)</span> deactivates his public key.</p></li>
<li><p>Person <span class="math inline">\(A\)</span> activates a new public key based on the old public key using ZK proof and rerandomization.</p></li>
</ol>
<p>Let’s see what happens when the coordinator processes the messages.</p>
<ol type="1">
<li><p>The first message will be valid and will update the state related to the public key of person 1 (a vote for option 2 will be entered and the new public key of person <span class="math inline">\(A\)</span> will become public key 2).</p></li>
<li><p>The second message will not be valid and there will be no state change (because person <span class="math inline">\(A\)</span>’s public key has become public key 2, not 1, as signed in the message).</p></li>
<li><p>It will change the state of public key 2 of person 1 to inactive. When the key state is inactive, that vote is not counted in the total. Therefore, the vote for option 2 is not counted at this time. Also, the coordinator updates the set <span class="math inline">\(D\)</span> and writes to it the public key 2 and the encrypted states (using ElGamal encryption)- vote for option 2.</p></li>
<li><p>New key - public key 3 (of person <span class="math inline">\(A\)</span>, but the coordinator does not know that it is the public key of person <span class="math inline">\(A\)</span>) writes to the set of public keys and registers a new state (vote for option 2 is now written and this key is considered active).</p></li>
</ol>
<p>Note that person <span class="math inline">\(A\)</span> used all 4 message types in the proposed protocol. In this way, person <span class="math inline">\(A\)</span> voted for the desired option 2. Also, by decrypting the second message, person <span class="math inline">\(A\)</span> can “prove” to the blackmailer that he voted for option 1. And let’s note that the coordinator does not know how the person <span class="math inline">\(A\)</span> voted.</p>
</section>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>The research showed that it is possible to achieve complete anonymity of voting, i.e.&nbsp;it was shown that it is possible to avoid that coordinator knows options that each individual voter voted for. Also, for this purpose, codes were made in circom language for ElGamal encryption, decryption and re-randomization. The next step could be the implementation of the presented solution.</p>
</section>
<section id="bibliography" class="level1">
<h1>Bibliography</h1>

<p>[1] MACI, https://github.com/0x3327/3327-operations/blob/babb99c2eec36b95a84c04bde6bd9bb01851e534/_research/ERFC-291.md</p>
<p>[2] Can MACI really destroy the collusion?, https://3327.io/can-maci-really-destroy-the-collusion/</p>
<p>[3] Release Announcement: MACI 1.0, https://medium.com/privacy-scaling-explorations/release-announcement-maci-1-0-c032bddd2157</p>
<p>[4] A Technical Introduction to MACI 1.0, https://medium.com/privacy-scaling-explorations/a-technical-introduction-to-maci-1-0-db95c3a9439a</p>
<p>[5] ECDH Key Exchange, https://cryptobook.nakov.com/asymmetric-key-ciphers/ecdh-key-exchange</p>
<p>[6] Cryptography, http://poincare.matf.bg.ac.rs/~ezivkovm/nastava/kripto.pdf</p>
<p>[7] Cryptography - Notes, http://poincare.matf.bg.ac.rs/~aleksandar/files/kripto/2020/Skripta.pdf</p>
<p>[8] MACI anonymization - using rerandomizable encryption, https://ethresear.ch/t/maci-anonymization-using-rerandomizable-encryption/7054/1</p>
<p>[9] Pairings for beginners, https://static1.squarespace.com/static/5fdbb09f31d71c1227082339/t/5ff394720493bd28278889c6/1609798774687/PairingsForBeginners.pdf</p>
<p>[10] Circom 2 Documentation, https://docs.circom.io/</p>
<p>[11] ElGamal encryption, decryption, and rerandomization, with circom support, https://ethresear.ch/t/elgamal-encryption-decryption-and-rerandomization-with-circom-support/8074</p>
<p>[12] ElGamal codes for encryption, decryption and re-randomization, https://github.com/MarijaMikic/ElGamal</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" role="doc-bibliography">

</div></section></div></main> <!-- /main -->
<script type="text/javascript">

// replace cmd keyboard shortcut w/ control on non-Mac platforms
const kPlatformMac = typeof navigator !== 'undefined' ? /Mac/.test(navigator.platform) : false;
if (!kPlatformMac) {
   var kbds = document.querySelectorAll("kbd")
   kbds.forEach(function(kbd) {
      kbd.innerHTML = kbd.innerHTML.replace(/⌘/g, '⌃');
   });
}

</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="0x3327/research" data-repo-id="R_kgDOG-cOHQ" data-category="Research" data-category-id="DIC_kwDOG-cOHc4COB27" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Proudly supported by <a href="https://mvpworkshop.co"><img src="https://mvpworkshop.co/wp-content/uploads/2021/01/mvp-logo.png" class="img-fluid" width="65"></a></div>   
      <div class="nav-footer-center">
        <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../../about.html">About</a>
  </li>  
</ul>
      </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/3327_io">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/0x3327/research">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>